<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>ChangelogMaker - FrikyBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- GENERAL CSS -->
    <link href="../../styles/standard.css" rel="stylesheet">
    <link href="../../styles/Grid/Grid_Foundation.css" rel="stylesheet">

    <!-- PAGE CSS-->
    <link href="../../styles/Grid/Grid_Default.css" rel="stylesheet">

    <!-- GENERAL JS-->
    <script src="../../scripts/standard.js"></script>

    <!-- MISC -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <script src="../misc/NavigationV2/NavigationV2.js"></script>
    <link href="../misc/NavigationV2/NavigationV2.css" rel="stylesheet">

    <script src="../misc/OUTPUT/OUTPUT.js"></script>
    <link href="../misc/OUTPUT/OUTPUT.css" rel="stylesheet">

    <script src="../misc/BOT_STATUS/BOT_STATUS.js"></script>
    <link href="../misc/BOT_STATUS/BOT_STATUS.css" rel="stylesheet">

    <script src="../misc/Login/Login.js"></script>
    <link href="../misc/Login/Login.css" rel="stylesheet">

    <script src="../News/News_scripts"></script>
    <script src="../News/changelog_scripts"></script>
    <link href="../News/changelog_styles" rel="stylesheet">

    <script src="../misc/SwitchButton/SwitchButton.js"></script>
    <link href="../misc/SwitchButton/SwitchButton.css" rel="stylesheet">

    <style>
        .darkmode #grid #content {
            background-color: #292929 !important;
            color: white;
        }
    </style>
</head>
<body onload="Standard_Page_Init(); init();">
    <!-- MAIN GRID -->
    <div id="grid">
        <!-- NAVI HEADER -->
        <div class="cellM" id="naviHeader">
            <a href="../../">FRIKY<span>BOT</span></a>
        </div>

        <!-- CONTENT HEADER -->
        <div class="cellM" id="contentHeader">

        </div>

        <!-- NAVI -->
        <div class="cellM" id="navi">
            <div id="BOT_STATUS_DETAILS_MINI">

            </div>
            <div id="mainNavi">

            </div>
            <button id="LightModeButton" onclick="toggleLightMode()">DarkMode</button>
            <div id="license"> - <a href="https://fontawesome.com/license" target="_blank">Icon license</a> - </div>
        </div>

        <!-- ACTUAL CONTENT -->
        <div class="cellM" id="content" style="background-color: #f5f5f5;">

            <script>
                const INPUT_TEXT_KEYWORDS = {
                    'c': 'COMMENT',
                    'a': 'ADDED',
                    'r': 'REMOVED',
                    'ch': 'CHANGED',
                    'w': 'WARNING'
                };
                const TEST_DATA = {
                    "date": 1621447200000,
                    "title": "WEBSITE START Changelog - 13. SEPTEMBER 2020",
                    "chapters": {
                        "Introduction": [
                            {
                                "type": "PLAIN",
                                "paragraphs": [
                                    "FrikyBot Changelogs now available for pretty much any Changes! More Features/Details will be added in the Future, but this is a pretty good start i´d say!",
                                    "Check the <a href=''>Documentation</a> for more details!"
                                ]
                            }
                        ],
                        "CORE MODULE CHANGES": [
                            {
                                "type": "CHANGES",
                                "module_type": "LOGGER",
                                "contents": [
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added Logging support to all Packages and CORE Modules."
                                            },
                                            {
                                                "type": "COMMENT",
                                                "text": "Logging enables a more clean and structured Console Output, aswell as an option to export them to a File (for Debugging/Crash Reports) or to give an external Log for Administrators!"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "type": "CHANGES",
                                "module_type": "SERVER",
                                "contents": [
                                    {
                                        "type": "HEADER",
                                        "text": "General"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "CHANGED",
                                                "text": "Changed Config Setup - now using multiple Files and a more streamlined Checking/Updating flow."
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added a Console based Setup Wizrad allowing minimal Config Settings."
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "Console Input"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added Support for Console Commands controlling Packages, Modules and more!"
                                            },
                                            {
                                                "type": "COMMENT",
                                                "text": "First Step for external controlling of the core Bot functionality. More will follow, once the Foundation of the Server- and Website-Interfaces are set."
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "HTML"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "CHANGED",
                                                "text": "Changed Routing of ALL Endpoints Routes by using express´s Routers and route()-functions."
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "API Endpoints"
                                    },
                                    {
                                        "type": "LIST",
                                        "elements": [
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /BotStatus"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Navi"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Packages"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Cookies"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "PACKAGE CHANGES": [
                            {
                                "type": "CHANGES",
                                "module_type": "PACKAGE",
                                "packagename": "PACKAGEBASE",
                                "contents": [
                                    {
                                        "type": "HEADER",
                                        "text": "General"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "CHANGED",
                                                "text": "Changed Init and Setup of Packages. More details in the Docs."
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added Init()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added PostInit()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added reload()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added enable()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added disable()"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "Config / Settings"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "CHANGED",
                                                "text": "Changed Package Settings location and Setup. More details in the Docs."
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added loadSettings()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added CheckSettings(settings: Object)"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added changeSettings(settings: Object)"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "HTML / API"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "CHANGED",
                                                "text": "Changed Package HTML/API hosting using Express.js Routers."
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added useDefaultFileRouter()"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added setFileRouter(router: ExpressRouter)"
                                            },
                                            {
                                                "type": "ADDED",
                                                "detailed": true,
                                                "text": "Added setAPIRouter(router: ExpressRouter)"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added Website Navigation Option for Pacakges -> setHTMLNavigation(data: Object)"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "Package Interconnect"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Package Interconnect - Share/add/remove/... Features between Packages."
                                            },
                                            {
                                                "type": "COMMENT",
                                                "text": "Package Interconnects are a KEY Element of the FrikyBot. Using others work to expand and make your own, is ALWAYS a good thing! More Information on how to use/supply Package Interconnections take a look into the Docs!"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "type": "CHANGES",
                                "module_type": "PACKAGE",
                                "packagename": "NEWSFEED",
                                "contents": [
                                    {
                                        "type": "HEADER",
                                        "text": "General"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added NewsFeed to the FrikyBot Website."
                                            },
                                            {
                                                "type": "COMMENT",
                                                "text": "A NewsFeed and a good Changelog is very important for Developers, but also for Users! Gives a small inside look, on what I am working on and what might come next! Soon this might also extend as a Twitter Bot?! but just maybe ;)"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "HTML"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News -> All News (Archive)"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/[News Page Identifier] -> Shows Extended Form of a News"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/NewsMaker -> Page where Admins/Editors/... can publish News"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/News_styles -> CSS Stylesheet used to Display various Types of News"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/News_scripts -> Javascript Script used to Display/Fetch News"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/Changelog -> All Changelogs (Archive)"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/Changelog_styles -> CSS Stylesheet used to Display various Types of Changelogs"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "Added /News/Changelog_scripts -> Javascript Script used to Display/Fetch Changelogs"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "detailed": true,
                                        "text": "API"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /latest"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /oldest"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /News"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "POST: /Publish"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Changelog"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Changelog/:changelog"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "type": "CHANGES",
                                "module_type": "PACKAGE",
                                "packagename": "DOCS",
                                "contents": [
                                    {
                                        "type": "HEADER",
                                        "text": "General"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added Documentation for the FrikyBot Code."
                                            },
                                            {
                                                "type": "COMMENT",
                                                "text": "This will always be as good as I can, for my own sake in having a better overview of that mess :D"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "text": "HTML"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "Added /Docs -> All Documentation (Archive)"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "HEADER",
                                        "detailed": true,
                                        "text": "API"
                                    },
                                    {
                                        "type": "DASHED_PLAIN",
                                        "paragraphs": [
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Docs"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Docs/:module"
                                            },
                                            {
                                                "type": "ADDED",
                                                "text": "GET: /Docs/:module/:class"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    },
                    page: "TESTDATA"
                };
                let DROPMODE = null;
                let DROP_SRC_PARENT = null;

                function init() {
                    OUTPUT_create();
                    Bot_Status_Details_Settings.ErrorOutput = OUTPUT_showError;

                    //Check Query
                    let query = "";
                    if (GetURLSearchArray().length > 0) query = "?" + GetURLSearchArray()[0].name + "=" + GetURLSearchArray()[0].value[0];

                    fetchChangelog(query)
                        .then(json => {
                            CHANGELOGMAKER_fill(query == "" ? {} : json.Changelogs[0]);
                            CHANGELOGMAKER_updatePreview();
                            document.getElementById('NEWS_FEED_ChangelogMaker').style.display = "grid";
                            document.getElementById('SaveBTN').disabled = true;
                        })
                        .catch(err => {
                            console.log(err);
                            OUTPUT_showError(err.message);
                            OUTPUT_showError('ACCESS DENIED');
                        });
                }

                //Data
                function CHANGELOGMAKER_updatePreview() {
                    let json = CHANGELOGMAKER_generateJSON();
                    if (json.page === 'URL-Friendly Title here' || Object.getOwnPropertyNames(json.chapters).length == 0) {
                        document.getElementById('SaveBTN').disabled = true;
                        return;
                    }
                    document.getElementById('SaveBTN').disabled = false;
                    document.getElementById('CHANGELOG_PREVIEW').innerHTML = createChangelog(json);
                }
                function CHANGELOGMAKER_generateJSON() {
                    let json = {
                        date: new Date(document.getElementById('Editor_Input_Date').value).getTime(),
                        title: document.getElementById('Editor_Input_Title').value,
                        page: document.getElementById('Editor_Input_Page').value || document.getElementById('Editor_Input_Page').placeholder,
                        chapters: {

                        }
                    };

                    //Chapters
                    for (let chapt of document.getElementsByClassName('Chapter')) {
                        if (!chapt.childNodes[1].childNodes[0].value) continue;
                        json.chapters[chapt.childNodes[1].childNodes[0].value] = CHANGELOGMAKER_generateListJSON(chapt.childNodes[1].childNodes[1].childNodes[3].childNodes);
                    }

                    return json;
                }
                function CHANGELOGMAKER_generateListJSON(list = []) {
                    let out = [];

                    for (let thng of list) {
                        let thing_data = {
                            type: thng.dataset.type
                        };
                        let childs = thng.childNodes[1].childNodes;

                        if (thng.dataset.type === 'HEADER') {
                            thing_data['text'] = childs[1].value;
                        } else if (thng.dataset.type === 'PLAIN') {
                            thing_data['paragraphs'] = CHANGELOGMAKER_ANALYSE_INPUTTEXT(childs[1].value);
                        } else if (thng.dataset.type === 'DASHED_PLAIN') {
                            thing_data['paragraphs'] = CHANGELOGMAKER_ANALYSE_INPUTTEXT(childs[1].value);
                        } else if (thng.dataset.type === 'LIST') {
                            thing_data['elements'] = CHANGELOGMAKER_ANALYSE_INPUTTEXT(childs[1].value);
                        } else if (thng.dataset.type === 'CHANGES') {
                            let inner_childs = childs[1].childNodes;

                            let op = inner_childs[0].options[inner_childs[0].selectedIndex];
                            let optgroup = op.parentNode.dataset.value;

                            thing_data.display_type = optgroup;
                            thing_data.name = op.value;

                            thing_data['contents'] = CHANGELOGMAKER_generateListJSON(inner_childs[1].childNodes[3].childNodes);
                        }

                        out.push(thing_data);
                    }

                    return out;
                }

                function CHANGELOGMAKER_fill(json = {}) {
                    document.getElementById('Editor_Input_Title').value = json.title || '';
                    let date = new Date(json.date || Date.now());

                    let year = date.getFullYear();
                    if (year < 10) year = "0" + year;

                    let month = date.getMonth() + 1;
                    if (month < 10) month = "0" + month;

                    let dt = date.getDate();
                    if (dt < 10) dt = "0" + dt;

                    let min = date.getHours();
                    if (min < 10) min = "0" + min;

                    let sec = date.getMinutes();
                    if (sec < 10) sec = "0" + sec;

                    document.getElementById('Editor_Input_Date').value = year + "-" + month + "-" + dt + "T" + min + ":" + sec;
                    document.getElementById('Editor_Input_Page').value = json.page || '';

                    for (let chapter in json.chapters || {}) {
                        CHANGELOGMAKER_Chapter_add(chapter, json.chapters[chapter]);
                    }

                    //Update Preview
                    CHANGELOGMAKER_updatePreview();
                }
                function CHANGELOGMAKER_save() {
                    let options = getAuthHeader();
                    options['method'] = GetURLSearchArray().length < 1 ? 'POST' : 'PUT';
                    options['headers']['Content-Type'] = 'application/json';
                    
                    let body = {
                        news_data: CHANGELOGMAKER_generateJSON()
                    };

                    //Check Query
                    let query = GetURLSearchArray().find(elt => elt.name === 'page');
                    if (query) body['old_page'] = query.value[0];

                    options['body'] = JSON.stringify(body);
                    
                    fetch(CHANGLOG_SETTINGS.API_ENDPOINT, options)
                        .then(STANDARD_FETCH_RESPONSE_CHECKER)
                        .then(json => {
                            document.getElementById('SaveBTN').disabled = true;
                            OUTPUT_showInfo("Changelog Saved!");
                        })
                        .catch(err => {
                            OUTPUT_showError("Saving failed!");
                            console.log(err);
                        });
                }

                //Main
                function CHANGELOGMAKER_PageTitle() {
                    let s = 'URL-Friendly Title here';

                    if (document.getElementById('Editor_Input_Title').value) s = toURLFriendlyText(document.getElementById('Editor_Input_Title').value);
                    if (document.getElementById('Editor_Input_Date').value) s = toURLFriendlyText(NEWS_FEED_getFullDateString(document.getElementById('Editor_Input_Date').value));

                    document.getElementById('Editor_Input_Page').placeholder = s;
                }

                //Chapter
                function CHANGELOGMAKER_Chapter_add(name, things) {
                    let elt = document.createElement("div");
                    elt.classList.add("Element");
                    elt.classList.add('Chapter');
                    elt.id = CHANGELOGMAKER_generateID();
                    elt.setAttribute('draggable', 'true');
                    elt.setAttribute('ondragstart', 'CHANGELOGMAKER_drag(this, event);');
                    elt.innerHTML = CHANGELOGMAKER_Chapter_create(name, things);
                    document.getElementById("Chapter_List_Content").append(elt);
                }
                function CHANGELOGMAKER_Chapter_create(name, things = []) {
                    let s = "";

                    s += '<div><span>' + (document.getElementsByClassName('Chapter').length + 1) + '</span></div>';

                    s += '<div class="Element_Content">';
                    s += '<input placeholder="Chapter Title here" oninput="CHANGELOGMAKER_updatePreview();" value="' + (name || '') + '"/>';

                    //Thing List Start
                    s += '<div class="List" draggable="false">';
                    s += '<h4>Things</h4>';
                    s += '<img src="../images/icons/trash-alt-solid.svg" ondragover="CHANGELOGMAKER_allowTrashwDrop(event);" ondrop="CHANGELOGMAKER_dropTrash(event, \'Thing\');"/>';
                    s += '<button title="Add Thing" onclick="CHANGELOGMAKER_Thing_add(this.parentElement)">+</button>';
                    s += '<div class="List_Content Things_List" draggable="false">'

                    for (let i = 0; i < things.length; i++) {
                        s += CHANGELOGMAKER_Thing_add(null, i, things[i]);
                    }

                    s += '</div>';
                    s += '</div>';
                    //Thing List End

                    s += '</div>';
                    s += '<img draggable="false" src="../images/icons/arrows-alt-solid.svg" ondragover="CHANGELOGMAKER_allowChapterDrop(event);" ondrop="CHANGELOGMAKER_dropChapter(event);"/>';

                    return s;
                }

                //Thing
                function CHANGELOGMAKER_Thing_add(elt, index, data) {
                    if (elt) {
                        let location = findLocation('Things_List', elt);
                        let div = document.createElement("div");
                        div.classList.add("Element");
                        div.classList.add('Thing');
                        div.id = CHANGELOGMAKER_generateID();
                        div.dataset.type = "HEADER";
                        div.setAttribute('draggable', 'true');
                        div.setAttribute('ondragstart', 'CHANGELOGMAKER_drag(this, event);');
                        div.innerHTML = CHANGELOGMAKER_Thing_create(location);
                        location.append(div);
                    } else {
                        let s = '<div class="Element Thing" data-type="' + (data.type || 'HEADER') + '" id="' + CHANGELOGMAKER_generateID() + '" draggable="true" ondragstart="CHANGELOGMAKER_drag(this, event);" >';
                        s += CHANGELOGMAKER_Thing_create(index, data);
                        s += '</div>';
                        return s;
                    }
                }
                function CHANGELOGMAKER_Thing_create(at, data) {
                    let index = (at instanceof Element ? at.childNodes.length + 1 : at);

                    let s = '<div><span>' + index + '</span></div>';

                    s += '<div class="Element_Content">';
                    s += CHANGELOGMAKER_Thing_createContent(data);
                    s += '</div>';

                    s += '<img draggable="false" src="../images/icons/arrows-alt-solid.svg" ondragover="CHANGELOGMAKER_allowThingDrop(event);" ondrop="CHANGELOGMAKER_dropThing(event);" />';
                    return s;
                }
                function CHANGELOGMAKER_Thing_createContent(thing) {
                    const types = ['HEADER', 'PLAIN', 'DASHED_PLAIN', 'LIST', 'CHANGES'];
                    if (!thing) thing = { type: types[0] }

                    let s = '';
                    s += '<select onchange="CHANGELOGMAKER_Thing_Change(this)">';
                    for (let typ of types) {
                        s += '<option value="' + typ + '" ' + (thing.type == typ ? 'selected' : '') + '>' + typ + '</option>';
                    }
                    s += '</select>';
                    s += CHANGELOGMAKER_Thing_createType(thing);

                    return s;
                }
                function CHANGELOGMAKER_Thing_createType(thing = {}) {
                    let s = "";

                    if (thing.type == "PLAIN") {
                        s = '<textarea placeholder="Enter Paragraphs here (Line seperated | [d]: detailed | [c]: comment [a]: added [r]: removed [ch]: changed [w]: warning)" oninput="CHANGELOGMAKER_updatePreview();">' + CHANGELOGMAKER_ANALYSE_INVERSETEXT(thing.paragraphs) + '</textarea>';
                    } else if (thing.type == "DASHED_PLAIN") {
                        s = '<textarea placeholder="Enter Paragraphs here (Line seperated | [d]: detailed | [c]: comment [a]: added [r]: removed [ch]: changed [w]: warning)" oninput="CHANGELOGMAKER_updatePreview();">' + CHANGELOGMAKER_ANALYSE_INVERSETEXT(thing.paragraphs) + '</textarea>';
                    } else if (thing.type == "LIST") {
                        s = '<textarea placeholder="Enter Paragraphs here (Line seperated | [d]: detailed | [c]: comment [a]: added [r]: removed [ch]: changed [w]: warning)" oninput="CHANGELOGMAKER_updatePreview();">' + CHANGELOGMAKER_ANALYSE_INVERSETEXT(thing.elements) + '</textarea>';
                    } else if (thing.type == "HEADER") {
                        s = '<input value="' + (thing.text || '') + '" placeholder="Enter Title here" oninput="CHANGELOGMAKER_updatePreview();" />';
                    } else if (thing.type == "CHANGES") {
                        s = '<div class="CHANGELOGMAKER_CHANGES">';

                        s += '<select onchange="CHANGELOGMAKER_updatePreview()">';
                        for (let typ in CHANGELOG_CUSTOMS) {
                            s += '<optgroup data-value="' + typ + '" label="' + typ + '">';
                            for (let mdl in CHANGELOG_CUSTOMS[typ]) {
                                s += '<option value="' + mdl + '" ' + (mdl === thing.name ? 'selected' : '') + '>' + mdl + '</option>';
                            }
                            s += '</optgroup>';
                        }
                        s += '</select>';

                        //Thing List
                        s += '<div class="List">';
                        s += '<h4>Things</h4>';
                        s += '<img src="../images/icons/trash-alt-solid.svg" ondragover="CHANGELOGMAKER_allowTrashwDrop(event);" ondrop="CHANGELOGMAKER_dropTrash(event, \'Thing\');"/>';
                        s += '<button title="Add Thing" onclick="CHANGELOGMAKER_Thing_add(this.parentElement)">+</button>';
                        s += '<div class="List_Content Things_List">'

                        for (let i = 0; i < (thing.contents || []).length; i++) {
                            s += CHANGELOGMAKER_Thing_add(null, i, thing.contents[i]);
                        }

                        s += '</div>';
                        s += '</div>';
                        //Thing List

                        s += '</div>';
                    }

                    return s;
                }
                function CHANGELOGMAKER_Thing_Change(elt) {
                    elt.parentElement.parentElement.dataset.type = elt.value;
                    elt.parentElement.innerHTML = CHANGELOGMAKER_Thing_createContent({ type: elt.value });
                }

                //Dragging
                function CHANGELOGMAKER_drag(elt, e) {
                    if (e.dataTransfer.getData("id")) return;
                    if (e.layerX < elt.clientWidth - 20) e.preventDefault();
                    e.dataTransfer.setData('type', elt.classList.contains('Chapter') ? 'Chapter' : 'Thing');
                    e.dataTransfer.setData("id", elt.id);
                    DROPMODE = elt.classList.contains('Chapter') ? 'Chapter' : 'Thing';
                    DROP_SRC_PARENT = elt.parentElement.parentElement;
                }

                function CHANGELOGMAKER_allowTrashwDrop(e) {
                    if (DROPMODE === 'Chapter' && e.path[3].classList.contains('Editor')) e.preventDefault();
                    else if (DROPMODE === 'Thing' && !e.path[3].classList.contains('Editor')) {

                        //Parent
                        if (e.target.parentElement !== DROP_SRC_PARENT) return;
                        e.preventDefault();
                    }
                }
                function CHANGELOGMAKER_dropTrash(e, type) {
                    DROPMODE = null;
                    if (type !== e.dataTransfer.getData('type')) return;

                    //Parent
                    if (document.getElementById(e.dataTransfer.getData('id')).parentElement.parentElement !== e.target.parentElement) return;

                    document.getElementById(e.dataTransfer.getData('id')).remove();
                    CHANGELOGMAKER_updatePreview();
                }

                function CHANGELOGMAKER_allowChapterDrop(e) {
                    if (DROPMODE === 'Chapter') e.preventDefault();
                }
                function CHANGELOGMAKER_dropChapter(e) {
                    if (DROPMODE !== 'Chapter') return;
                    DROPMODE = null;
                    let src = document.getElementById(e.dataTransfer.getData('id'));
                    let target = e.target;

                    while (!target.classList.contains('Chapter') && target.tagName !== 'BODY') {
                        target = target.parentElement;
                    }
                    if (target.tagName == 'BODY') return;
                    if (target == src) return;

                    //Target
                    //[old content] [move] [id]
                    target.appendChild(target.childNodes[0]);
                    //[old content] [move] [id] [new content]
                    target.appendChild(src.childNodes[1]);
                    //[old content] [id] [new content] [move]
                    target.appendChild(target.childNodes[1]);

                    //Src
                    //[move] [id]
                    src.appendChild(src.childNodes[0]);
                    //[move] [id] [new content]
                    src.appendChild(target.childNodes[0]);
                    //[id] [new content] [move]
                    src.appendChild(src.childNodes[0]);

                    CHANGELOGMAKER_updatePreview();
                }

                function CHANGELOGMAKER_allowThingDrop(e) {
                    if (DROPMODE === 'Thing') e.preventDefault();
                }
                function CHANGELOGMAKER_dropThing(e) {
                    if (DROPMODE !== 'Thing') return;
                    DROPMODE = null;
                    let src = document.getElementById(e.dataTransfer.getData('id'));
                    let target = e.target;

                    while (!target.classList.contains('Thing') && target.tagName !== 'BODY') {
                        target = target.parentElement;
                    }
                    if (target.tagName == 'BODY') return;
                    if (target == src) return;

                    let temp_type = target.dataset.type;

                    //Target
                    //[old content] [move] [id]
                    target.appendChild(target.childNodes[0]);
                    //[old content] [move] [id] [new content]
                    target.appendChild(src.childNodes[1]);
                    //[old content] [id] [new content] [move]
                    target.appendChild(target.childNodes[1]);

                    target.dataset.type = src.dataset.type;

                    //Src
                    //[move] [id]
                    src.appendChild(src.childNodes[0]);
                    //[move] [id] [new content]
                    src.appendChild(target.childNodes[0]);
                    //[id] [new content] [move]
                    src.appendChild(src.childNodes[0]);

                    src.dataset.type = temp_type;

                    CHANGELOGMAKER_updatePreview();
                }

                //Util
                function CHANGELOGMAKER_ANALYSE_INVERSETEXT(paragraphs = []) {
                    let s = "";

                    for (let p of paragraphs) {
                        if (s) s += '\n';
                        if (p instanceof Object) {
                            if (p.detailed) s += '[d]';

                            for (let keyword in INPUT_TEXT_KEYWORDS) {
                                if (p.type !== INPUT_TEXT_KEYWORDS[keyword]) continue;
                                s += '[' + keyword + ']' + p.text;
                            }
                        } else {
                            s += p;
                        }
                    }
                    return s;
                }
                function CHANGELOGMAKER_ANALYSE_INPUTTEXT(text) {
                    let paragraphs = [];

                    for (let p of text.split('\n')) {
                        let count = paragraphs.length;
                        for (let keyword in INPUT_TEXT_KEYWORDS) {
                            if (p.indexOf('[' + keyword + ']') < 0) continue;

                            let data = { type: INPUT_TEXT_KEYWORDS[keyword], text: p.substring(Math.max(p.indexOf('[' + keyword + ']') + 2 + keyword.length, p.indexOf('[d]') + 4)) };
                            if (p.indexOf('[d]') > -1) data.detailed = true;

                            paragraphs.push(data);
                            break;
                        }

                        if (paragraphs.length === count && p.indexOf('[d]') > -1) paragraphs.push({ text: p.substring(4), detailed: true });
                        else if (paragraphs.length === count) paragraphs.push(p);
                    }

                    return paragraphs;
                }
                function findLocation(className, wrapper_elt) {
                    for (let elt of wrapper_elt.childNodes) {
                        if (elt.classList.contains(className)) return elt;
                    }

                    return null;
                }
                function toURLFriendlyText(text) {
                    let friendly = "";
                    const allowed = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "-"];
                    const conversions = {
                        'ä': 'ae',
                        'ü': 'ue',
                        'ö': 'oe',
                        ' ': '-',
                        '.': '_'
                    };

                    for (let char of text.toLowerCase()) {
                        if (conversions[char] !== undefined) friendly += conversions[char];
                        if (allowed.find(elt => elt === char) !== undefined) friendly += char;
                    }

                    return friendly;
                }
                function CHANGELOGMAKER_generateID() {
                    let id = "";
                    const MAX_LENGTH = 5;
                    const allowed = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];

                    do {
                        id = "RNG_";
                        for (let i = 0; i < MAX_LENGTH; i++) {
                            id += allowed[Math.floor(Math.random() * allowed.length)];
                        }
                    } while (document.getElementById(id));
                    return id;
                }
            </script>

            <output></output>

            <div id="NEWS_FEED_ChangelogMaker">
                <div class="Editor">
                    <h1>CHANGELOG MAKER <button id="SaveBTN" onclick="CHANGELOGMAKER_save()" disabled>SAVE</button></h1>
                    <div style="position: relative; height: 30px;">
                        <input id="Editor_Input_Date" type="datetime-local" oninput="CHANGELOGMAKER_PageTitle(); CHANGELOGMAKER_updatePreview();" />
                    </div>
                    <input id="Editor_Input_Title" placeholder="Title here" oninput="CHANGELOGMAKER_PageTitle(); CHANGELOGMAKER_updatePreview();" />
                    <br />
                    <input id="Editor_Input_Page" placeholder="URL-Friendly Title here" oninput="CHANGELOGMAKER_updatePreview();" />

                    <div>
                        <div class="List">
                            <h4>Chapters</h4>
                            <img src="../images/icons/trash-alt-solid.svg" ondragover="CHANGELOGMAKER_allowTrashwDrop(event);" ondrop="CHANGELOGMAKER_dropTrash(event, 'Chapter');" />
                            <button title="Add Chapter" onclick="CHANGELOGMAKER_Chapter_add()">+</button>
                            <div class="List_Content" id="Chapter_List_Content">

                            </div>
                        </div>
                    </div>
                </div>
                <div id="CHANGELOG_PREVIEW">

                </div>
            </div>
        </div>
    </div>
</body>
</html>